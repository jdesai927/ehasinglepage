use eha

ehaObjectId = ObjectId()

db.service_entity.insert(
{
  "_id": ehaObjectId,
  "name": "e Health Access",
  "type": "Service Provider",
  "address": {"streetaddress1": "44 Meenakshi towers", 
  "streetaddress2": "4th floor, Banjara hills", 
  "city":"Hyderabad", 
  "state":"AP", 
  "zipcode": "5000038", 
  "country": "India",
  "locs" : [ [ 55.5 , 42.3 ] ,
           [ -74 , 44.74 ] ,
           { "lng" : 55.5 , "lat" : 42.3 } ]
  },
  "phone_contact" : "1 800 1030365, 040 6462 6262, 040 4912 1212",
  "email_contact" : "info@ehealthaccess.com, customercare@ehealthaccess.com",
  "website" : "www.ehealthaccess.com",
  "logo" : "img/logo/safksdjf29324r093.jpg",
  "write_up" : "Innovative Telemedicine ecosystem creator",
  "onboard_date": new Date("Oct 10, 2011"),
  "services": ["Virtual Doctor Consultation", "Health Camp", "Health Talk", "Corporate Wellness"]}
)
AarthiObjectId = ObjectId()

db.service_entity.insert(
{
  "_id": AarthiObjectId,
  "name": "Aarthi Scans",
  "type": "Service Provider",
  "address": {"streetaddress1": "98 12th street", 
  "streetaddress2": "2nd Avenue, AnnaNagar", 
  "city":"Chennai", 
  "state":"TN", 
  "zipcode": "600102", 
  "country": "India",
  "locs" : [ [ 65.5 , 72.3 ] ,
           [ -74 , 44.74 ] ,
           { "lng" : 65.5 , "lat" : 72.3 } ]
  },
  "phone_contact" : "1 800 10929387 , 044 26285055",
  "email_contact" : "info@AarthiScans.com, customercare@AarthiScans.com",
  "website" : "www.AarthiScans.com",
  "logo" : "img/logo/safksdjf29324r053.jpg",
  "write_up" : "Providing better health through better diagnostics",
  "onboard_date": new Date("Oct 09, 2012"),
  "services": ["Tests", "Health Camp", "Diagnostics"]}
)
vineetObjectId = ObjectId()

db.service_entity.insert(
{
  "_id": vineetObjectId,
  "name": "Vineet Poly Clinic",
  "type": "Service Provider",
  "address": {"streetaddress1": "1 Azab towers", 
  "streetaddress2": "1st floor, Towlichowki", 
  "city":"Hyderabad", 
  "state":"AP", 
  "zipcode": "5000038", 
  "country": "India",
  "locs" : [ [ 55.5 , 42.3 ] ,
           [ -74 , 44.74 ] ,
           { "lng" : 53.5 , "lat" : 41.3 } ]
  },
  "phone_contact" : "040 4912 1212",
  "email_contact" : "DrVineetClicni@gmail.com",
  "logo" : "img/logo/dfsdf88dsf9324r093.jpg",
  "write_up" : "Dr. Vineet has been praciticing medicine from 2005, and he takes pride in ensuring quality services...",
  "onboard_date": new Date("Jan 10, 2013"),
  "services": ["Doctor Consultation", "Home Visit"]
}
)


//Corporate user
db.users.insert(
   {
     "name": { "salute": "Mr.", "first": "Ram", "last": "Kadambi" },
     "date_of_birth": new Date("Sep 05, 1973"),
     "sex": "Male",
     "mobile": "09500041219",
     "email": "ram.kadambi@gmail.com",
     "type": "Patient",
     "date_of_Joining": new Date("Jan 10, 2012"),
     "languages": ["English", "Hindi", "Tamil"],
     "affiliated_to" :[ {"name": "e Health Access", "service_entity_ID" : ObjectId("51bc2858c2ae8f9f0b3a480d")
}],
     "avatarURL" : "img/avatar/1349409823.jpg",
     "address": {
      "streetaddress1": "Apt 32, Blg 1A", 
      "streetaddress2": "Akash street", 
      "city":"Chennai", 
      "state":"TN", 
      "zipcode": "600119",
      "country": "India"
      },

     "patient": {
      "plan": "Corporate 599",
      "plan_ID": null,
      "next_renewal_date": new Date("Jan 09, 2014"),
     
      },

   }
)

db.users.insert(
   {
     "name": { "salute": "Ms.", "first": "Vinitha", "last": "Ravichandran" },
     "date_of_birth": new Date("Aug 31, 1992"),
     "sex": "Female",
     "mobile": "09790756853",
     "email": "Vinitha318@gmail.com",
     "type": "Patient",
     "date_of_Joining": new Date("Jun 10, 2013"),
     "languages": ["English", "Hindi", "Tamil","Telugu"],
     "affiliated_to" :[ {"name": "e Health Access", "service_entity_ID" : ehaObjectId}],
     "avatarURL" : "img/avatar/1349409825.jpg",
     "address": {
      "streetaddress1": "Apt 39, Blg 1A", 
      "streetaddress2": "Akashan street", 
      "city":"Chennai", 
      "state":"TN", 
      "zipcode": "600120",
      "country": "India"
      },

     "patient": {
      "plan": "Corporate 599",
      "plan_ID": null,
      "next_renewal_date": new Date("Jan 09, 2014"),
      "organization_name": "Cipher Cloud Inc.",
      "organization_ID": cipherCloudObjectId,
      },

   }
)
//Corporate user - HR Point of contact
db.users.insert(
   {
     "name": { "salute": "Mrs.", "first": "Girija", "last": "Kumar" },
     "date_of_birth": new Date("Apr 05, 1970"),
     "sex": "Female",
     "mobile": "09500041219",
     "email": "HR@ciphercloud.com",
     "type": "Patient",
     "date_of_Joining": new Date("Jan 10, 2012"),
     "languages": ["English", "Hindi", "Telugu"],
     "affiliated_to" :[ {"name": "e Health Access", "service_entity_ID" : ehaObjectId}],
     "avatarURL" : "img/avatar/dfdsfs234.jpg",
     "address": {
      "streetaddress1": "Apt 15, B Block", 
      "streetaddress2": "White Fields, Kondapur", 
      "city":"Hyderabad", 
      "state":"AP", 
      "zipcode": "500038",
      "country": "India"
      },

     "patient": {
      "plan": "Corporate 599",
      "plan_ID": null,
      "next_renewal_date": new Date("Jan 09, 2014"),
      "organization_name": "Cipher Cloud Inc.",
      "organization_ID": cipherCloudObjectId,
      },

   }
)


//Retail Individual user 
db.users.insert(
   {
     "name": { "salute": "Mr.", "first": "Inthiyaz", "last": "Ahamad" },
     "date_of_birth": new Date("Apr 05, 1980"),
     "sex": "Male",
     "mobile": "09500041219",
     "email": "Inthiyaz@gmail.com",
     "type": "Patient",
     "date_of_Joining": new Date("Feb 10, 2013"),
     "languages": ["English", "Hindi", "Telugu"],
     "affiliated_to" :[ {"name": "e Health Access", "service_entity_ID" : ehaObjectId}],
     "avatarURL" : "img/avatar/dfdsfs234.jpg",
     "address": {
      "streetaddress1": "Apt 10, B Block", 
      "streetaddress2": "10th Cross Road, Banjara Hills", 
      "city":"Hyderabad", 
      "state":"AP", 
      "zipcode": "500058",
      "country": "India"
      },

     "patient": {
      "plan": "Plan 499",
      "plan_ID": null,
      "next_renewal_date": new Date("Feb 09, 2014")
      },

   }
)

//Retail Family primary user
db.users.insert(
   {
     "name": { "salute": "Mr.", "first": "Phani", "last": "Reddy" },
     "date_of_birth": new Date("Apr 05, 1985"),
     "sex": "Male",
     "mobile": "09500041219",
     "email": "Phani@gmail.com",
     "type": "Patient",
     "date_of_Joining": new Date("Apr 10, 2013"),
     "languages": ["English", "Telugu"],
     "affiliated_to" :[ {"name": "e Health Access", "service_entity_ID" : ehaObjectId}],
     "avatarURL" : "img/avatar/dfdsfs234.jpg",
     "address": {
      "streetaddress1": "Apt 10, B Block", 
      "streetaddress2": "10th Cross Road, Banjara Hills", 
      "city":"Hyderabad", 
      "state":"AP", 
      "zipcode": "500058",
      "country": "India"
      },

     "patient": {
      "plan": "Plan 999",
      "plan_ID": null,
      "next_renewal_date": new Date("Apr 09, 2014")
      },

      "dependents" : [
      {"name": "Mrs. Phani Reddy", "relationship" :"Spouse", "dependent_ID": null},
      {"name": "Master Phani Reddy", "relationship" :"Son", "dependent_ID": null}
      ]

   }
)

//Retail Family dependent user
db.users.insert(
   {
     "name": { "salute": "Mrs.", "first": "Phani", "last": "Reddy" },
     "date_of_birth": new Date("Apr 05, 1989"),
     "sex": "Female",
     "mobile": "09500041219",
     "email": "Mrs.Phani@gmail.com",
     "type": "Patient",
     "date_of_Joining": new Date("Apr 10, 2013"),
     "languages": ["English", "Telugu"],
     "affiliated_to" :[ {"name": "e Health Access", "service_entity_ID" : ehaObjectId}],
     "avatarURL" : "img/avatar/dfdsfs234.jpg",
     "address": {
      "streetaddress1": "Apt 10, B Block", 
      "streetaddress2": "10th Cross Road, Banjara Hills", 
      "city":"Hyderabad", 
      "state":"AP", 
      "zipcode": "500058",
      "country": "India"
      },

     "patient": {
      "plan": "Dependent Plan",
      "plan_ID": null,
      "next_renewal_date": new Date("Apr 09, 2014")
      },

      "primary" : 
      {"name": "Mr. Phani Reddy", "primary_ID": null}

   }
)



//Doctor - Service provider
db.users.insert(
   {
     "name": { "salute": "Dr.", "first": "Sandeep", "last": "Raju" },
     "date_of_birth": new Date("Jan 01, 1980"),
     "sex": "Male",
     "mobile": "09500041219",
     "email": "Dr.Sandeep@ehealthaccess.com",
     "type": "Doctor",
     "date_of_Joining": new Date("Sep 10, 2011"),
     "languages": ["English", "Hindi", "Telugu", "Tamil"],
     "affiliated_to" :[ 
     {"name": "e Health Access", "service_entity_ID" : ehaObjectId}, 
     {"name": "Vineet Poly Clinic", "service_entity_ID" : vineetObjectId }
     ],
     "avatarURL" : "img/avatar/2848jhf928.jpg",
     "address": {
      "streetaddress1": "44 Meenakshi towers", 
      "streetaddress2": "4th floor, Banjara hills", 
      "city":"Hyderabad", 
      "state":"AP", 
      "zipcode": "500038", 
      "country": "India"
     },

     "doctor": {
       "plan": "Internal GP Plan",
        "plan_ID": null,
        "mci_number" : "1238MJJ99",
        "speciality" : ["Family Practice", "General Physician"],
        "credentials": [
            {"name": "MBBS", "institution": "Karnataka University", "year": "2001"},
            {"name": "Paper on Rural m Health", "institution": "Telemedicine societ meet - Kovai", "year":"2012"}
          ],
    "about_me": "Doctor version about self",
    "references" : [
{"name": "Apollo hospital Madhapur", "description": "performed eye camp for the hospital patients", "date_from" : new Date("Mar 05,2010"), "date_to": new Date("Mar 10, 2010")}
],
 "testimonial" : [
{"patient_name" : "Inthiyaz A" , "patient_city" : "Hyderabad", "date_created" : new Date("June 01, 2013"), "comment": "Thanks for the quick response, it was very helpful for me..", patient_ID: null}
],
"visiting_time" : [
        {"consultation_day":"Monday", "consultation_time": ["0900","0915","0930","0945","1000","1500","1515","1530","1545"]},
        {"consultation_day":"Tuesday", "consultation_time": ["0900","0915","0930","0945","1000","1500","1515","1530","1545"]},
        {"consultation_day":"Wednesday", "consultation_time": ["0900","0915","0930","0945","1000","1500","1515","1530","1545"]},
        {"consultation_day":"Thursday", "consultation_time": ["0900","0915","0930","0945","1000","1500","1515","1530","1545"]},
        {"consultation_day":"Friday", "consultation_time": ["0900","0915","0930","0945","1000","1500","1515","1530","1545"]},
        {"consultation_day":"Saturday", "consultation_time": ["1100","1115","1130","1145","1200","1200","1215","1230","1245"]}
        ]
      }
   

   }
)

db.users.insert(
   {
     "name": { "salute": "Dr.", "first": "Shalini", "last": "Singh" },
     "date_of_birth": new Date("Jun 01, 1981"),
     "sex": "Female",
     "mobile": "0989041219",
     "email": "Dr.Shalini@ehealthaccess.com",
     "type": "Doctor",
     "date_of_Joining": new Date("Oct 10, 2011"),
     "languages": ["English", "Hindi", "Telugu", "Tamil"],
     "affiliated_to" :[ 
     {"name": "e Health Access", "service_entity_ID" : ehaObjectId}, 
     {"name": "Vineet Poly Clinic", "service_entity_ID" : vineetObjectId }
     ],
     "avatarURL" : "img/avatar/2848jhf928.jpg",
     "address": {
      "streetaddress1": "44 Meenakshi towers", 
      "streetaddress2": "4th floor, Banjara hills", 
      "city":"Hyderabad", 
      "state":"AP", 
      "zipcode": "500038", 
      "country": "India"
     },

     "doctor": {
       "plan": "Internal GP Plan",
        "plan_ID": null,
        "mci_number" : "92368JJ99",
        "speciality" : ["Family Practice", "General Physician"],
        "credentials": [
            {"name": "MBBS", "institution": "Karnataka University", "year": "2001"},
            {"name": "Paper on Rural m Health", "institution": "Telemedicine societ meet - Kovai", "year":"2012"}
          ],
    "about_me": "Doctor version about self",
    "references" : [
{"name": "Apollo hospital Madhapur", "description": "performed eye camp for the hospital patients", "date_from" : new Date("Mar 05,2010"), "date_to": new Date("Mar 10, 2010")}
],
 "testimonial" : [
{"patient_name" : "Inthiyaz A" , "patient_city" : "Hyderabad", "date_created" : new Date("June 01, 2013"), "comment": "Thanks for the quick response, it was very helpful for me..", patient_ID: null}
],
"visiting_time" : [
        {"consultation_day":"Monday", "consultation_time": ["1500","1515","1530","1545","1600","1615","1630"]},
        {"consultation_day":"Tuesday", "consultation_time": ["0900","0915","0930","0945","1000","1500","1515","1530","1545"]},
        {"consultation_day":"Wednesday", "consultation_time": ["0900","0915","0930","0945","1000","1500","1515","1530","1545"]},
        {"consultation_day":"Thursday", "consultation_time": ["0900","0915","0930","0945","1000","1500","1515","1530","1545"]},
        {"consultation_day":"Friday", "consultation_time": ["0900","0915","0930","0945","1000","1500","1515","1530","1545"]},
       
        ]
      }
   

   }
)
db.users.insert(
   {
     "name": { "salute": "Dr.", "first": "Vaishnav", "last": "Davey" },
     "date_of_birth": new Date("Jan 01, 1986"),
     "sex": "Male",
     "mobile": "080041219",
     "email": "Dr.Vaishnav@AarthiScans.com",
     "type": "Doctor",
     "date_of_Joining": new Date("Sep 10, 2011"),
     "languages": ["English", "Hindi", "Telugu", "Tamil"],
     "affiliated_to" :[ 
     
     {"name": "AarthiScans", "service_entity_ID" : ObjectId("51bc2d4cc2ae8f9f0b3a4817")}
     ],
     "avatarURL" : "img/avatar/2848jhf928.jpg",
     "address": {
      "streetaddress1": "4 Lakshmi towers", 
      "streetaddress2": "6th floor, Red hills", 
      "city":"Chennai", 
      "state":"TN", 
      "zipcode": "600038", 
      "country": "India"
     },

     "doctor": {
       "plan": "Internal GP Plan",
        "plan_ID": null,
        "mci_number" : "237MHJG8292",
        "speciality" : ["Cardiologist", "General Physician"],
        "credentials": [
            {"name": "MBBS", "institution": "Annamalai University", "year": "2001"}
          ],
    "about_me": "Doctor version about self",
    "references" : [
{"name": "Apollo hospital Chennai", 
"description": "performed open heart surgery  for the nairobipatients", 
"date_from" : new Date("Mar 05,2010"), "date_to": new Date("Mar 10, 2010")
}
],
 "testimonial" : [
{"patient_name" : "Ram kadambi A" , 
"patient_city" : "Hyderabad", 
"date_created" : new Date("June 09, 2013"), 
"comment": "Thanks for the quick response, it was very helpful for me..", 
patient_ID: null}
],
"visiting_time" : [
        {"consultation_day":"Saturday", "consultation_time": ["1100","1115","1130","1145","1200","1200","1215","1230","1245"]},
         {"consultation_day":"Sunday", "consultation_time": ["1000","1015","1030","1045","1100","1115","1130","1145","1200","1200","1215","1230","1245"]}
        ]
      }
   

   }
)
db.users.insert(
   {
     "name": { "salute": "Dr.", "first": "Nivedhita", "last": "Davey" },
     "date_of_birth": new Date("Jan 01, 1976"),
     "sex": "Female",
     "mobile": "080041219",
     "email": "Dr.Nivedhita@AarthiScans.com",
     "type": "Doctor",
     "date_of_Joining": new Date("Sep 20, 2010"),
     "languages": ["Tamil"],
     "affiliated_to" :[ 
     {"name": "e Health Access", "service_entity_ID" : ehaObjectId}, 
     {"name": "AarthiScans", "service_entity_ID" : AarthiObjectId }
     ],
     "avatarURL" : "img/avatar/2848jhf928.jpg",
     "address": {
      "streetaddress1": "4 Lakshmi towers", 
      "streetaddress2": "6th floor, Red hills", 
      "city":"Chennai", 
      "state":"TN", 
      "zipcode": "600038", 
      "country": "India"
     },

     "doctor": {
       "plan": "Internal GP Plan",
        "plan_ID": null,
        "mci_number" : "526SLJG8292",
        "speciality" : ["Orthodontist", "General Physician"],
        "credentials": [
            {"name": "MBBS", "institution": "Annamalai University", "year": "1995"}
          ],
    "about_me": "Doctor version about self",
    "references" : [
{"name": "Apollo hospital Chennai", 
"description": "performed spine replacement  for the nairobipatients", 
"date_from" : new Date("Mar 05,2010"), "date_to": new Date("Mar 10, 2010")
}
],
 "testimonial" : [
{"patient_name" : "Vinitha" , 
"patient_city" : "Hyderabad", 
"date_created" : new Date("June 09, 2013"), 
"comment": "Thanks for the quick response, it was very helpful for me..", 
patient_ID: null}
],
"visiting_time" : [
         {"consultation_day":"Saturday", "consultation_time": ["1100","1115","1130","1145","1200","1200","1215","1230","1245"]},
        {"consultation_day":"Friday", "consultation_time": ["1100","1115","1130","1145","1200","1200","1215","1230","1245"]},
         {"consultation_day":"Sunday", "consultation_time": ["1000","1015","1030","1045","1100","1115","1130","1145","1200","1200","1215","1230","1245"]}
        ]
      }
   

   }
)


/*{
"LocationID" : 58269,
"Country" : "US",
"Region" : "GA",
"City" : "Atlanta",
"PostalCode" : 92619,
"Latitude" : 33.6453,
"Longitude" : -117.8423,
"Blocks" : [
  { "Start" : 2061605888, "End" : 3061606143 },
  { "Start" : 1061840384, "End" : 3061840639 },
  { "Start" : 3064361104, "End" : 3064361119 },
  { "Start" : 3083381760, "End" : 3083382015 },
  { "Start" : 3117868656, "End" : 3117868671 },
  { "Start" : 3119495168, "End" : 3119495295 }
]}
)

db.iploc.find(
{ "Blocks.Start": 2061840384 }, {Blocks:0}
)


db.iploc.find({ "Blocks" : {"$elemMatch" : {
  "Start": 1061840384, 
  "End" : { "$gte" : 202785025 }}}},
{Blocks : 0}
);*/

use eha
//delete documents if any for consultations
db.consultations.remove()

//Consultation for the first time from customer with no previous record and no new vital
//consultation created by the customer

db.consultations.insert(
{
  "patient_name": "Mr. Inthiyaz A",
  "patient_ID": null,
  "doctor_name": "Dr. Vineet K",
  "doctor_ID": null,
  "consultation_date": new Date("Jun 21, 2013"),
  "consultation_slot" : "1500",
  "consultation_mode" : "VIDEO",
  "consultation_reason" : "Have constant Head ache",
  "created_by": null,
  "status": "Open"
  })

db.consultations.insert(
{
  "patient_name": "Mr. Ram kadambi",
  "patient_ID": null,
  "doctor_name": "Dr. Vaishnav Davey",
  "doctor_ID": null,
  "consultation_date": new Date("Jun 22, 2013"),
  "consultation_slot" : "1530",
  "consultation_mode" : "PHONE",
  "consultation_reason" : "Have swollen jaw",
  "created_by": null,
  "status": "Open"
  })


//consultation with Vitals calculated for the first time
//consultation created by customer
db.consultations.insert(
{
  "patient_name": "Ms. Vinitha",
  "patient_ID": null,
  "doctor_name": "Dr. Vineet K",
  "doctor_ID": null,
  "consultation_date": new Date("Jun 21, 2013"),
  "consultation_slot" : "1500",
  "consultation_mode" : "VIDEO",
  "consultation_reason" : "Have constant Head ache",
  "created_by": null,
  "status" : "Open",
  })

objectConsultationID = db.consultations.find({"patient_name": "Mr. Inthiyaz A"}, {"_ID": 1})
//doctor updating consultation with accept confirmation
db.consultations.update
({
  "_id" : ObjectId("51bc3939b4e4c76eefbbf630")
},
{
  $set: {"status":"Accept"}
}
  )

//use it using the name for time being
db.consultations.update({"patient_name": "Mr. Inthiyaz A"}, {$set: {"status":"Accept"}})


//doctor updating consultation with diagnosis
/*db.consultations.update({"patient_name": "Mr. Inthiyaz A"}, {$set: {"status":"Complete", "diagnosis": "Take rest, drink lot of water and stay away from sun for two days"}})

//doctor updating consultation with medications - separate subdocument[s]
db.consultations.update({"patient_name": "Mr. Inthiyaz A"}, {$set: {"status":"Complete", "medications.name": "Dolo 650", "medications.dosage": "1-0-1", "medications.frequency": "2 days"}})
db.users.find({"name.first":/^V/, "type":"Patient"})

db.users.find({"doctor.visiting_time.consultation_day":"Monday"}).pretty()

db.users.find({"doctor.visiting_time.consultation_day":"Monday"}, {"doctor":0,
"affiliated_to":0,"address":0}).pretty()



db.users.find({ "visiting_time" : {"$elemMatch" : {
  "consultation_day": "Monday", 
  "consultation_time" : { "$gte" : "1500" }}}}
);

db.users.find({ "visiting_time" : {"$elemMatch" : {
  "consultation_day": "Monday", 
  "consultation_time" : { "$gte" : "1500" }}}}
);*/

//Query to get list of Doctors by affinity = e Health Acce

db.users.find({"type":"Doctor"},{"affiliated_to.name" : "e Health Access"} {"name" : 2}).pretty()

//query to list doctor by individual name = "Dr. Vineet"
  db.users.find({"type":"Doctor","name.first" :"Vaishnav"},{"doctor.speciality" : 1});

  //Query to doctor by speciality = General Physician, Cardiologist
   db.users.find({"doctor.speciality" : { $in: [ "General Physician","Cardiologist" ] }},{"doctor.speciality":1}).pretty()


    var date= db.consultations.find({ "_id": ObjectId("51bc8bc0c2ae8f9f0b3a4820")},{"consultation_date":1,"_id":0}).limit(1).toArray()[0]

    /*db.users.find( { type: "Doctor" },{ visiting_time: { $elemMatch: { consultation_day: "Monday" } , consultation_time: { $gt: 1000}}} )
    //db.users.find({type:"Doctor", visiting_time.consultation_day : 'Monday'});
    db.users.find({ "visiting_time" : {"$elemMatch" : {"consultation_day" : "Monday" }}});
db.iploc.update( {_id : ObjectId("51bd5360f1078f5d0d3b8db0")},
       { $push: { Blocked : {date : new Date("Jun 22, 2013"), time : 1500 }} })
db.iploc.find({ "Blocked" : {"$elemMatch" : {"time" : 1500 }}})*/


//query to pushed the blocked time slot for the doctor

> db.users.update( {"name.first":"Mohana"},        { $pushAll: [{ Blocked : {Appoitment_date : new Date("Jun 16, 2013"), Appointment_time : "1200" }}] })

/************************************************************************************************************************/

// new consultation happens .. the user selects the date and time
db.consultations.insert(
{
  "patient_name": "Mr. Ram kadambi",
  "patient_ID": null,
  "doctor_name": "Dr. Vaishnav Davey",
  "doctor_ID": null,
  "consultation_date": new Date("Jun 16, 2013"),
  "consultation_slot" : "1400",
  "consultation_mode" : "PHONE",
  "consultation_reason" : "Have swollen jaw",
  "created_by": null,
  "status": "Complete"
  })

db.consultations.insert(
{
  "patient_name": "Mr. Ram kadambi",
  "patient_ID": null,
  "doctor_name": "Dr. Vaishnav Davey",
  "doctor_ID": null,
  "consultation_date": new Date("Jun 17, 2013"),
  "consultation_slot" : "1200",
  "consultation_mode" : "PHONE",
  "consultation_reason" : "Have swollen jaw",
  "created_by": null,
  "status": "Complete"
  })

db.consultations.insert(
{
  "patient_name": "Mr. Ram kadambi",
  "patient_ID": null,
  "doctor_name": "Dr. Vaishnav Davey",
  "doctor_ID": null,
  "consultation_date": new Date("Jun 16, 2013"),
  "consultation_slot" : "1200",
  "consultation_mode" : "PHONE",
  "consultation_reason" : "Have swollen jaw",
  "created_by": null,
  "status": "Complete"
  })

db.consultations.insert(
{
  "patient_name": "Mr. Ram kadambi",
  "patient_ID": null,
  "doctor_name": "Dr. Nivedhita Davey",
  "doctor_ID": null,
  "consultation_date": new Date("Jun 22, 2013"),
  "consultation_slot" : "1200",
  "consultation_mode" : "PHONE",
  "consultation_reason" : "Have swollen jaw",
  "created_by": null,
  "status": "Open"
  })

// the patients's document gets updated with the new appointment based on the id
db.users.update( {"_id" : ObjectId("51bc290dc2ae8f9f0b3a4810")},
       { $push: { Blocked : {Appointment_date : new Date("Jun 16, 2013"), Appointment_time : "1200" }} })

/* on having multiple appointments the Patient's(user) document looks like
  
 "Blocked" : [
         {
                 "Appointment_date" : ISODate("2013-06-15T18:30:00Z"),
                 "Appointment_time" : "1200"
         },
         {
                 "Appointment_date" : ISODate("2013-06-16T18:30:00Z"),
                 "Appointment_time" : "1300"
         }
 ],*/
 // the Doctor's document gets updated with the new appointment based on the id
 
 db.users.update(  {"name.first":"Mohana"},
       { $pushAll: { Blocked : [{Appointment_date : new Date("Jun 15, 2013"), Appointment_time : "1900" }]} })

//cron job to remove the finished appointments for the day based on date

//part 1 : in consultation collection
//part 1.a) assuming that even if an appointment gets postponed (status changed).. a new date will be attached to it
db.consultations.remove({"consultation_date": new Date("Jun 16, 2013")});
//part 1.b) assuming that even if an appointment gets postponed (status changed)..but the user or the doctor has teh liberty to not mention the new postponed date
 db.consultations.remove({"consultation_date": new Date("Jun 16, 2013"), status:"Complete"});

// part 2 : in users collection
 db.users.update( {"Blocked.Appointment_date":   ISODate("2013-06-16T18:30:00Z")}, { $pop: {"Blocked":1 } } );



// Query to get Doctor visting time for a given date and time (from user table)
 db.users.find( { type="Doctor",visiting_time: { $elemMatch: { consultation_day: "Monday" } } } );


//Query to check consultation for a given patient for today + future appointments
//there r 2 ways to do it one from consultation table using Patient[doctor] name or from user table.But on doing it from the user table since we dont obtain any other details abt the consultation other than the date and time , it wont be of much help when displaying in the UI  
//ASSUMPTION: We fix the future time slot to be a month.. it can be varied though

var present_date= new Date("Jun 16, 2013");
var future_date = new Date("Jun 16, 2014");
db.consultations.find({patient_name:"Mr. Ram kadambi",consultation_date: {$gte: present_date, $lt: future_date}}).pretty();//can use patient_id also

//Query to check consultation for a given Doctor for today + future appointments
db.consultations.find({doctor_name:"Dr. Nivedhita Davey",consultation_date: {$gte: presen
t_date, $lt: future_date}}).pretty();

//for performance .. we cud create an index for Patient_name ..(but its optional)
db.posts.ensureIndex({patient_name:1})

// query to update consultation, consultation status : when doctor cancels appointment 
//ASSUMPTION: this involves 2 updates , one at the consultation table and another at the user table

//in consultations table
db.consultations.update({"doctor_name" : "Dr. Nivedhita Davey" , "patient_name": "Mr. Ram kadambi","consultation_date": new Date("jun 22, 2013"),"consultation_slot" : "1200"}, {$set: {"status":"Cancel"}})
/*//in users table
db.users.update( {"name.first" : "Nivedhita","Blocked.Appointment_date":   new Date("Jun 22, 2013"),"Blocked.Appointment_time" : "1200"}, { $pop: {"Blocked":1 } } );
db.users.update( {"name.first" : "Ram","Blocked.Appointment_date":   new Date("Jun 22, 2013"),"Blocked.Appointment_time" : "1200"}, { $pop: {"Blocked":1 } } );


//query to update consultation,diagnosis,consultation_status=complete(change from "accept" to "complete")
//using _id
db.consultations.update({ "_id" : ObjectId("51bd809a4dfa786bd5245467")}, {$set: {"status":"Complete", "diagnosis": "Take rest, dont talk"}})
//(or) using attributes
db.consultations.update({"doctor_name" : "Dr. Nivedhita Davey" , "patient_name": "Mr. Ram kadambi","consultation_date": new Date("jun 22, 2013"),"consultation_slot" : "1200"}, {$set: {"status":"Complete", "diagnosis": "Take rest, dont talk"}})
*/
//query to update consultation,diagnosis,Medications,consultation_status=complete(change from "accept" to "complete")
//using _id and only one medication but AVOID  using this statement because later on wanting to add an array of medicines for the same consultation teh structure is little deformed making it difficult of futher read
//eg below wingas obtained on using two pushes , this problem was solved using pushAll..so even on having one medication..its better to use pushALl so that later updation is easy
/*[
        {
                "name" : "Pan40",
                "dosage" : "1-0-1",
                "frequency" : "3 days"
        },
        {
                "name" : "clamp",
                "dosage" : "1-0-1",
                "frequency" : "3 days"
        }
],
[
        {
                "name" : "crocin",
                "dosage" : "1-0-1",
                "frequency" : "3 days"
        },
        {
                "name" : "sinorest",
                "dosage" : "1-0-1",
                "frequency" : "3 days"
        }
],*/
/*db.consultations.update( {"_id" : ObjectId("51bdf9ba318b6253e01ed02f")},
      {$set: {"status":"Complete", "diagnosis": "Take rest, dont talk"} ,$push: { medications : {name: "Pan40", dosage: "1-0-1",frequency: "3 days"}} })
//using _id and multiple medications
 db.consultations.update( {"_id" : ObjectId("51bdf9ba318b6253e01ed02f")},  {$set: {"status":"Accept", "diagnosis": "Take rest, dont talk"} ,$pushAll: { medications : [{name: "diprovate", dosage: "1-0-1",frequency: "3 days"},{name: "hicet", dosage: "1-0-1",frequency:"3 days"}]}})



//query to update consultation,diagnosis,Medications,LabTests,consultation_status=complete(change from "accept" to "complete")

db.consultations.update( {"_id" : ObjectId("51bdf9ba318b6253e01ed02f")},
     
        {
          $set: {"status":"Complete", "diagnosis": "Take rest, dont walk"} , 
           $pushAll: 
            {medications : [{name: "cfj", dosage: "1-0-1",frequency: "3 days"},{name: "kfj", dosage: "1-0-1",frequency: "3 days"}],
            LabTests : [{name: "blood sugar" ,"reading1" : "124","reading2" : "24","comment" : "sugar normal"},{"name" : "Urine","reading1" : "34", "comment" : "urine colouration normal"}]}
          
        }
      
        )
*/
// Updation of health Record,user table, vitals, consultations in the course of appointments

db.users.insert(
   {
     "name": { "salute": "Ms.", "first": "Vinitha", "last": "Ravichandran" },
     "date_of_birth": new Date("Aug 31, 1992"),
     "sex": "Female",
     "mobile": "09790756853",
     "email": "Vinitha318@gmail.com",
     "type": "Patient",
     "date_of_Joining": new Date("Jun 10, 2013"),
     "languages": ["English", "Hindi", "Tamil","Telugu"],

     "avatarURL" : "img/avatar/1349409825.jpg",
     "address": {
      "streetaddress1": "Apt 39, Blg 1A", 
      "streetaddress2": "Akashan street", 
      "city":"Chennai", 
      "state":"TN", 
      "zipcode": "600120",
      "country": "India"
      },

     "patient": {
      "plan": "Corporate 599",
      "plan_ID": null,
      "next_renewal_date": new Date("Jan 09, 2014"),
      "organization_name": "Cipher Cloud Inc.",
      
      },

   }
)

//part 1 :(before any apointment) 

//Health record for the patient is created as follows

db.health_records.insert(
{
  "patient_name": "Ms. Vinitha Ravichandran",
  "patient_ID" : ObjectId("51c1413a16aa2a7046cc0c77") ,
}

//vitals are updated in the health record

db.health_records.update( {"patient_name": "Ms. Vinitha Ravichandran"},       {
 $pushAll: {"vitals" :  [{     "temperature": "190.5",     "SBP": "30",     "DBP": "50",     "Weight": "85",     "date_of_capture": new Date("Jun 19, 2013")
  }]         }       }             )

  // part 2 : First new Consultation
  // the new consulation details are entered and vitals if any  was earlier recorded is added..
  db.consultations.insert(
 {
   "patient_name": "Ms. Vinitha Ravichandran",
   "patient_ID": ObjectId("51c1413a16aa2a7046cc0c77"),
   "doctor_name": "Dr. Nivedhita Davey",
   "doctor_ID": ObjectId("51bc49c2c2ae8f9f0b3a481a"),
   "consultation_date": new Date("Jun 22, 2013"),
   "consultation_slot" : "1200",
   "consultation_mode" : "PHONE",
   "consultation_reason" : "Feeling dizzy",
   "created_by": null,
   "status": "Open"
   })
// query to get last vital from health_records

// query to update the last vitals in consultation using Consultation id

db.consultations.update(    {  "_id" : ObjectId("51c144c316aa2a7046cc0c78") },    {
$set: {    last_vitals:    {"temperature": "98.5","SBP": "130","DBP": "90","Weight": "85","date_of_capture": new Date("Jun 14, 2013") },                            }
                               } ,    { upsert: true } )

//part 3: The consultation becomes complete 
//set the status to be complete  using consultation id
db.consultations.update(    {  "_id" : ObjectId("51c144c316aa2a7046cc0c78") },    {
$set: {     status: "Complete"}} )
//The medication , lab results etc are added to the health record

db.health_records.update( {"patient_name": "Ms. Vinitha Ravichandran"},
     
        {
          
           $pushAll: 
            {"medications": [
    {"name": "Dolo 650 mg",
    "dosage": "1-0-1",
    "duration": "3 days",
    "date_prescribed": new Date("Jun 22, 2013")
      }
    ],
            "reports": [
      {
        "name":"CBT",
        "date_of_capture": new Date("Jun 22, 2013"),
        "file_src" : "/data/usr/reports/dsfklsdjfsdalj24r2.pdf"
        }]}
        }
      
        )
// The completed consultation is added to health_records
db.health_records.update( {"patient_name": "Ms. Vinitha Ravichandran"},
     
        {
          
           $pushAll: 
            { "consultations": [
    {"patient_name": "Ms. Vinitha Ravichandran",
  "patient_ID": ObjectId("51c1413a16aa2a7046cc0c77"),
  "doctor_name": "Dr. Nive Davey",
 "doctor_ID": ObjectId("51bc49c2c2ae8f9f0b3a481a"),
  "consultation_date": new Date("Jun 29, 2013"),
 "consultation_slot" : "1200",
  "consultation_mode" : "PHONE",
  "consultation_reason" : "Feeling dizzy",
  "created_by": null,
  "status": "Complete",
    "diagnosis": "Low blood pressure is the reason for dizziness.Take rest for couple of days.Medications-Dolo 650 mg-1-0-1-3 days.reports-CBT-/data/usr/reports/dsfklsdjfsdalj24r2.pdf"
      }
    ]}
        }
      
        )

// part 4 :  Second Consultation

db.consultations.insert(
 {
   "patient_name": "Ms. Vinitha Ravichandran",
   "patient_ID": ObjectId("51c1413a16aa2a7046cc0c77"),
   "doctor_name": "Dr. Nivedhita Davey",
   "doctor_ID": ObjectId("51bc49c2c2ae8f9f0b3a481a"),
   "consultation_date": new Date("Jun 23, 2013"),
   "consultation_slot" : "1200",
   "consultation_mode" : "PHONE",
   "consultation_reason" : "severe headache",
   "created_by": null,
   "status": "Open"
   })

// update the consultations with latest consulation and latest vitals

// query to get the latest consultation
db.health_records.aggregate([     { $match : {"patient_name": "Ms. Vinitha Ravichandran" } },
   
    {$unwind: '$consultations'}, 
    {$sort: {'consultations.consultation_date': -1}}, 

    {$group: {

      _id:{ _id: '$_id'},
       
        consultation: {$first: '$consultations'}
    }},
    
    {$project: {consultation:1}}
]);


// query to update with latest consultation

db.consultations.update(    {  "_id" : ObjectId("51c1453f16aa2a7046cc0c79") },  
  {$set: 
    {  last_vitals:    {"temperature": "98.5","SBP": "130","DBP": "90","Weight": "85","date_of_capture": new Date("Jun 14, 2013") },
    last_consultation: {
      "patient_name": "Ms. Vinitha Ravichandran",
  "patient_ID":  ObjectId("51c1413a16aa2a7046cc0c77"),
  "doctor_name": "Dr. Nivedhita Davey",
 "doctor_ID": ObjectId("51bc49c2c2ae8f9f0b3a481a"),
  "consultation_date": new Date("Jun 22, 2013"),
 "consultation_slot" : "1200",
  "consultation_mode" : "PHONE",
  "consultation_reason" : "Feeling dizzy",
  "created_by": null,
  "status": "Open",
    "diagnosis": "Low blood pressure is the reason for dizziness.Take rest for couple of days.Medications-Dolo 650 mg-1-0-1-3 days.reports-CBT-/data/usr/reports/dsfklsdjfsdalj24r2.pdf"
    }                           }
                               } ,    { upsert: true } )

// after the consultation gets completed .. repeat part 3

//query to get blocked time slots for a date
 db.users.aggregate([ { $match : { "_id" : ObjectId("51c46c6116aa2a7046cc0c7a")  },        
 {$unwind: '$Blocked'},         
 {$group: {           
  _id:{ date: '$Blocked.Appointment_date'},           
  slots:{$addToSet:'$Blocked.Appointment_time'}     
   }},    
    {$project: {'_id':1,slots:1}},     
    { $match : { "_id.date" :new Date("Jun 15,2013")} }     ]);

 //query to get total time slots for doc
 db.users.find( { "_id" : ObjectId("51c46c6116aa2a7046cc0c7a") }, { _id:0,"visiting_time.consultation_day":0,visiting_time: { $elemMatch: { consultation_day: "Monday" } } } )

 /* db.users.aggregate([ 
    { $match : { "_id" : ObjectId("51c46c6116aa2a7046cc0c7a")  }},        
   { $unwind: '$Blocked'},         
  {$group: {           
      _id:{ date: '$Blocked.Appointment_date'},           
        slots:{$addToSet:'$Blocked.Appointment_time'}     
   }},    
    {$project: {'_id':1,slots:1}},     
    { $match : { "_id.date" :d} }     ]);*/

//for populating health_records
db.health_records.insert(
{
  "patinent_name": "Mr. Inthiyaz A",
  "patient_ID" : null ,
  "consultations": 
  [
  {
  "doctor_name": "Dr. Vineet K",
  "doctor_ID": null,
  "consultation_date": new Date("Jun 21, 2013"),
  "consultation_slot" : "1500",
  "consultation_mode" : "VIDEO",
  "consultation_reason" : "Have constant Head ache",
  "created_by": null,
  "status" : "Complete",
  "diagnosis": "Take complete rest for couple of days" 
  },
  {
  "doctor_name": "Dr. Saneep",
  "doctor_ID": null,
  "consultation_date": new Date("May 28, 2013"),
  "consultation_slot" : "1500",
  "consultation_mode" : "PHONE",
  "consultation_reason" : "Have constant Neck pain and naseau",
  "created_by": null,
  "status" : "Complete",
  "diagnosis": "Based on our discussion , It looks like you had too much oiley food, Please avoid this going forward. The constant phone call taking with out headset is a major factor to your pain. Please take the prescribed medication for 2 days. Medication - Dolo 650 - 1- 0 - 1, 3 days" 
  }

  ],

"vitals" : [
  {
    "temperature": "98.5",
    "SBP": "130",
    "DBP": "90",
    "Weight": "85",
    "date_of_capture": new Date("Jun 14, 2013")
    },
    {
    "temperature": "98.5",
    "SBP": "130",
    "DBP": "90",
    "Weight": "85",
    "date_of_capture": new Date("May 28, 2013")
    }
    ],

    "medications": [
    {"name": "Dolo 650 mg",
    "dosage": "1-0-1",
    "duration": "3 days",
    "date_prescribed": new Date("May 28, 2013")
      }
    ],

      "reports": [
      {
        "name":"CBT",
        "date_of_capture": new Date("Jan 10, 2013"),
        "file_src" : "/data/usr/reports/dsfklsdjfsdalj24r2.pdf"
        },
        {
        "name":"Neck MRI Scan Report",
        "date_of_capture": new Date("May  30, 2013"),
        "comment" : "Came from Arthi Scans for checking the neck pain and naseau",
        "file_src" : "/data/usr/reports/dsfklsdjfsdalj24r2.pdf"
        }]

}
)

db.health_records.insert(
{
  "patient_name": "Ms. Vinitha Ravichandran",
  "patient_ID" : null ,
}

db.vitals.update( {"patient_name": "Ms. Vinitha Ravichandran"},
      {
          $pushAll: 
           {"vitals" : 
           [{
    "temperature": "98.5",
    "SBP": "30",
    "DBP": "90",
    "Weight": "85",
    "date_of_capture": new Date("Jun 12, 2013")
    }]
        }
      }
            )

db.consultations.insert(
{
  "patient_name": "Ms. Vinitha Ravichandran",
  "patient_ID": null,
  "doctor_name": "Dr. Nivedhita Davey",
  "doctor_ID": null,
  "consultation_date": new Date("Jun 22, 2013"),
  "consultation_slot" : "1200",
  "consultation_mode" : "PHONE",
  "consultation_reason" : "Feeling dizzy",
  "created_by": null,
  "status": "Open"
  })

 db.users.update(
   {  "_id" : ObjectId("51c46c6116aa2a7046cc0c7a") },
   {
     $set: {
             type:    "Doctor"
              
            }           
                     
    } ,
   { upsert: true }
)




db.health_records.find( { "patient_name": "Ms. Vinitha Ravichandran", $orderby: { "date_of_capture" : -1 } } )
db.health_records..find( { $query: {"patient_name": "Ms. Vinitha Ravichandran"}, $orderby: { "date_of_capture" : -1 } } )

db.health_records.update( {"patient_name": "Ms. Vinitha Ravichandran"},
     {
           $pushAll: 
            {
 
"allergies" :
[{"name":"bacterial infection", "date_of_capture": "Jun 9 ,2001","comments":"applied skin cream for two weeks"}] 
}
        }
      
        )


db.health_records.update( {"patient_name": "Ms. Vinitha Ravichandran"},
     
        {
          
           $pushAll: 
            { "immunizations": [
    { 
  "name": "Hepatits B",
  "date_of_application": new Date("Jan 10, 2001"),
  "comments": "Not an exact day, I know it got adminstered"
      },
      {"name": "Jaundice",
  "date_of_application": new Date("Jan 15, 2002"),}
 
    ]}
        }
      
        )